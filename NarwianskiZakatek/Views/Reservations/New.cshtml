@model NarwianskiZakatek.Models.Reservation

<div class="editor-label">
    @Html.LabelFor(model => model.BeginDate)
</div>
<div class="editor-field">
    @Html.EditorFor(model => model.BeginDate)
    @Html.ValidationMessageFor(model => model.BeginDate)
</div>

<div class="editor-label">
    @Html.LabelFor(model => model.EndDate)
</div>
<div class="editor-field">
    @Html.EditorFor(model => model.EndDate)
    @Html.ValidationMessageFor(model => model.EndDate)
</div>

<div class="row">
    <div class="col-md-4">
        @Html.DropDownList("RoomsList")
    </div>

    <div class="col-md-8">
        <a href="#" id="Refresh" class="btn btn-default">Odśwież</a>
    </div>
</div>

<script>
    $(function() {
        $("#BeginDate").datepicker;
        $("#EndDate").datepicker;
    });
</script>

<script type="text/javascript">
    var $select;

    $(document).ready(function() {
        $select = $('#RoomsList').selectize({
            valueField: 'RoomId',
            labelField: 'RoomNumber',
            searchField: ['RoomNumber', 'RoomCapacity'],
            sortField: 'RoomCapacity',
            onInitialize: function() {
                loadBooksAJAX();
            },
            render: {
                option: function(item, escape) {
                    return '<div class="selectDiv">' +
                        '<span class="mainName">' + escape(item.RoomNumber) + '</span><br />' +
                        '<span class="subLabel">Liczba łóżek: </span>' + '<span class="subValue">' + escape(item.RoomCapacity) + '</span>' +
                        '</div>';
                }
            }
        });

        $('#Refresh').click(function() {
            loadRoomsAJAX();
        });
    });

    function loadRoomsAJAX() {
        $.ajax({
            url: '/Reservations/FindAvailableRooms',
            type: 'POST',
            success: function(data) {
                for (var i = 0; i < data.length; i++)
                    $select[0].selectize.addOption(data[i]);
            },
            error: function(response) {
                alert(response);
            }
        });
    }
</script>